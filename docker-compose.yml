version: '3'

services:
  app:
    build: .
    restart: always
    hostname: "playground.yude.jp"
    volumes:
      - data:/root
    networks:
      - no-inet
    mem_limit: 256m

  cloudflared:
    image: cloudflare/cloudflared:2021.8.3
    user: root
    command: tunnel --hostname playground.yude.jp --url ssh://app:22 --loglevel info
    volumes:
      - '$HOME/.cloudflared:/root/.cloudflared'
    restart: always
    networks:
      - no-inet
      - inet

networks:
  no-inet:
    driver: bridge
    internal: true
  inet:
    driver: bridge

volumes:
  data:
    driver: local
    driver_opts:
      o: "size=10G"
      device: tmpfs
      type: tmpfs